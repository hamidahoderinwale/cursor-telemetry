<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live PKL Dashboard</title>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="assets/css/critical.css" as="style">
    <link rel="preload" href="assets/css/variables.css" as="style">
    <link rel="preload" href="assets/css/main.css" as="style">
    <link rel="preload" href="assets/js/loading.js" as="script">
    <link rel="preload" href="components/shared/dashboard.js" as="script">
    
    <!-- Critical CSS loaded first -->
    <link rel="stylesheet" href="assets/css/critical.css" onload="checkStylesheetsLoaded()">
    <link rel="stylesheet" href="assets/css/variables.css" onload="checkStylesheetsLoaded()">
    <link rel="stylesheet" href="assets/css/main.css" onload="checkStylesheetsLoaded()">
    
    <!-- External dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist@2.26.0/plotly.min.js"></script>
    
    <!-- Loading utilities -->
    <script src="assets/js/loading.js"></script>
</head>
<body>
    <!-- Loading overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>
    
    <div class="dashboard">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <div class="header-info">
                        <h1 class="header-title">Live PKL Dashboard</h1>
                        <p class="header-subtitle">Real-time monitoring of Cursor IDE sessions and notebook changes</p>
                    </div>
                    <div class="header-actions">
                        <div class="status-indicator">
                            <div class="status-dot" id="status-dot"></div>
                            <span id="status-text">Monitoring active</span>
                        </div>
                        <button class="btn btn-secondary btn-sm" onclick="window.location.href='/privacy-analysis'">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 1v6l4-4M6 8a6 6 0 0 0 2.8 10.7l-1.1 1.1A8 8 0 1 1 20 12h-2a6 6 0 0 1-6 6z"></path>
                            </svg>
                            Privacy Analysis
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="window.location.href='/post-mortem'">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
                                <line x1="12" y1="9" x2="12" y2="13"></line>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                            Post-mortem Analysis
                        </button>
                        <button class="btn btn-secondary btn-sm" id="refresh-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <polyline points="1 20 1 14 7 14"></polyline>
                                <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                            </svg>
                            Refresh
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Compact Stats Bar -->
                <section class="compact-stats">
                    <div class="stat-item">
                        <span class="stat-label">Sessions</span>
                        <span class="stat-value" id="total-sessions">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Changes</span>
                        <span class="stat-value" id="total-changes">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Avg Duration</span>
                        <span class="stat-value" id="avg-duration">0m</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Active</span>
                        <span class="stat-value active" id="active-sessions">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Conversations</span>
                        <span class="stat-value" id="total-conversations">0</span>
                    </div>
                </section>

                <!-- Search Bar -->
                <section class="search-section">
                    <div class="search-container">
                        <div class="search-input-wrapper">
                            <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                            <input type="text" class="search-input" id="search-input" placeholder="Search sessions (Cmd+K)" />
                            <div class="search-shortcut">Cmd+K</div>
                        </div>
                        <div class="search-filters">
                            <select class="filter-select" id="intent-filter">
                                <option value="">All Intents</option>
                                <option value="explore">Explore</option>
                                <option value="implement">Implement</option>
                                <option value="debug">Debug</option>
                                <option value="refactor">Refactor</option>
                            </select>
                            <select class="filter-select" id="outcome-filter">
                                <option value="">All Outcomes</option>
                                <option value="success">Success</option>
                                <option value="stuck">Stuck</option>
                                <option value="in-progress">In Progress</option>
                            </select>
                        </div>
                    </div>
                </section>

                <!-- View Controls -->
                <div class="view-controls">
                    <button class="view-btn" id="sessions-view-btn">Sessions View</button>
                    <button class="view-btn active" id="notebooks-view-btn">Notebook Grid</button>
                    <button class="view-btn" id="visualizations-view-btn">Visualizations</button>
                    <button class="view-btn" id="embeddings-view-btn">Embeddings (UMAP)</button>
                </div>

                <!-- Sessions List -->
                <section class="sessions-list" id="sessions-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14,2 14,8 20,8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10,9 9,9 8,9"></polyline>
                            </svg>
                        </div>
                        <h3 class="empty-state-title">No Active Sessions</h3>
                        <p class="empty-state-description">
                            Open a .ipynb file in Cursor IDE to start tracking your coding sessions and AI interactions.
                        </p>
                        <div class="empty-state-actions">
                            <button class="btn btn-primary" onclick="refreshData()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <polyline points="1 20 1 14 7 14"></polyline>
                                    <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                                </svg>
                                Refresh
                            </button>
                            <button class="btn btn-secondary" onclick="openHelp()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                </svg>
                                Help
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Session Detail Modal -->
    <div class="modal" id="sessionDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="session-detail-title">Session Details</h2>
                <button class="modal-close" onclick="closeSessionDetail()">&times;</button>
            </div>
            <div class="modal-body" id="session-detail-body">
                <!-- Session details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Main dashboard functionality -->
    <script src="components/shared/dashboard.js"></script>
</body>
</html>
