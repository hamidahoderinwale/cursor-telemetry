<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live PKL Dashboard</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="assets/css/variables.css" as="style">
    <link rel="preload" href="assets/css/main.css" as="style">
    <link rel="preload" href="assets/js/loading.js" as="script">
    <link rel="preload" href="components/shared/dashboard.js" as="script">
    
    <!-- Loading utilities - must be loaded before stylesheets that call checkStylesheetsLoaded() -->
    <script src="assets/js/loading.js"></script>
    
    <!-- CSS loaded first -->
    <link rel="stylesheet" href="assets/css/variables.css" onload="checkStylesheetsLoaded()">
    <link rel="stylesheet" href="assets/css/main.css" onload="checkStylesheetsLoaded()">
    
    <!-- External dependencies -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist@2.26.0/plotly.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    
    <!-- Real-time status styles -->
    <style>
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            transition: background-color 0.3s ease;
        }
        
        .status-dot.connected {
            background-color: var(--status-success);
            box-shadow: 0 0 6px var(--success-color);
        }
        
        .status-dot.disconnected {
            background-color: var(--status-error);
            box-shadow: 0 0 6px var(--danger-color);
        }
        
        .session-duration {
            color: var(--text-primary);
            font-weight: var(--font-weight-medium);
            font-size: 0.9rem;
        }
        
        .session-duration.active {
            color: var(--status-success);
            font-weight: var(--font-weight-semibold);
            animation: pulse 2s infinite;
        }
        
        .session-duration.inactive {
            color: var(--text-secondary);
            opacity: 0.8;
        }
        
        /* Privacy Analysis Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--background-modal);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .privacy-modal-content {
            max-width: 95vw;
            max-height: 95vh;
            width: 1200px;
            height: 800px;
            overflow-y: auto;
            background: var(--background-primary);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
        }
        
        .privacy-modal-content .modal-body {
            padding: 1rem;
            height: calc(100% - 60px);
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-header h3 {
            margin: 0;
            color: var(--text-primary);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.5rem;
        }
        
        .modal-close:hover {
            color: var(--text-primary);
        }
        
        /* Privacy Analysis Styles */
        .privacy-analysis-container {
            padding: 1rem;
        }
        
        .privacy-controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .config-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .config-label {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .config-input {
            width: 100%;
        }
        
        .privacy-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .metric-card {
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .privacy-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            justify-content: center;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-hover);
        }
        
        .btn-secondary {
            background: var(--background-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: var(--background-tertiary);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }
        
        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }
        
        /* Info Modal Styles */
        .info-container {
            padding: 1rem;
        }
        
        .info-container h4 {
            color: var(--text-primary);
            margin: 1rem 0 0.5rem 0;
            font-size: 1.1rem;
        }
        
        .info-container h4:first-child {
            margin-top: 0;
        }
        
        .info-container p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.6;
        }
        
        .info-container ul {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            padding-left: 1.5rem;
        }
        
        .info-container li {
            margin-bottom: 0.5rem;
        }
        
        .shortcuts-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .shortcut-item {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .shortcut-item kbd {
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-primary);
            min-width: 80px;
            text-align: center;
        }
        
        .shortcut-item span {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        /* Session Modal Styles */
        .session-detail-container {
            padding: 1rem;
        }
        
        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .session-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .session-status {
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .session-status.active {
            background: var(--success-color);
            color: white;
        }
        
        .session-status.completed {
            background: var(--info-color);
            color: white;
        }
        
        .session-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }
        
        .tab-btn {
            padding: 0.5rem 1rem;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        
        .tab-btn:hover {
            color: var(--text-primary);
        }
        
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        .session-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        /* Session Detail Modal Styles */
        .session-detail-content {
            padding: 0;
        }
        
        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }
        
        .session-title-section {
            flex: 1;
        }
        
        .session-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 0.5rem 0;
            line-height: 1.3;
        }
        
        .session-badges {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 0.5rem;
        }
        
        .event-type-badge,
        .project-badge,
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .event-type-badge {
            background: var(--info-color);
            color: white;
        }
        
        .project-badge {
            background: var(--background-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .status-badge {
            background: var(--success-color);
            color: white;
        }
        
        .status-badge.in_progress {
            background: var(--warning-color);
        }
        
        .status-badge.completed {
            background: var(--success-color);
        }
        
        .session-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            align-items: flex-start;
        }
        
        .session-metadata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .metadata-card {
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .metadata-header {
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .metadata-header h4 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .metadata-header h4::before {
            content: '';
            width: 4px;
            height: 16px;
            background: var(--primary-color);
            border-radius: 2px;
        }
        
        .metadata-content {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .metadata-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .metadata-item:last-child {
            border-bottom: none;
        }
        
        .metadata-label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
            min-width: 120px;
        }
        
        .metadata-value {
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.9rem;
            text-align: right;
            word-break: break-word;
            max-width: 200px;
        }
        
        .session-tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 1.5rem;
            background: var(--background-secondary);
            border-radius: 8px 8px 0 0;
            overflow: hidden;
        }
        
        .tab-btn {
            flex: 1;
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            border-bottom: 3px solid transparent;
        }
        
        .tab-btn:hover {
            color: var(--text-primary);
            background: var(--background-primary);
        }
        
        .tab-btn.active {
            color: var(--primary-color);
            background: var(--background-primary);
            border-bottom-color: var(--primary-color);
        }
        
        .tab-panel {
            display: none;
            padding: 1.5rem;
            background: var(--background-primary);
            border-radius: 0 0 8px 8px;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        .overview-content h4 {
            margin: 0 0 1rem 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .overview-content p {
            margin: 0 0 0.75rem 0;
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .overview-content strong {
            color: var(--text-primary);
            font-weight: 600;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .session-header {
                flex-direction: column;
                gap: 1rem;
            }
            
            .session-actions {
                width: 100%;
                justify-content: flex-start;
            }
            
            .session-metadata-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .metadata-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }
            
            .metadata-value {
                text-align: left;
                max-width: none;
            }
            
            .session-tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                text-align: left;
                border-bottom: 1px solid var(--border-color);
                border-right: none;
            }
        }
        
        /* Loading and Error States */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: var(--text-secondary);
        }
        
        .loading-spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        
        .error-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: var(--danger-color);
            background: var(--background-secondary);
            border: 1px solid var(--danger-color);
            border-radius: 8px;
            margin: 1rem;
        }
        
        .no-data {
            text-align: center;
            color: var(--text-secondary);
            padding: 2rem;
            font-style: italic;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .privacy-analysis-container {
            padding: var(--space-5);
            font-family: var(--font-family-base);
            color: var(--text-primary);
            background: var(--background-primary);
        }
        
        .privacy-controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-5);
        }
        
        .config-item {
            background: var(--background-secondary);
            padding: var(--space-4);
            border: 1px solid var(--border-color);
        }
        
        .config-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin-bottom: var(--space-2);
            font-weight: var(--font-weight-medium);
        }
        
        .config-input {
            width: 100%;
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--border-color);
            background: var(--background-primary);
            color: var(--text-primary);
            font-size: var(--font-size-sm);
            font-family: var(--font-family-base);
        }
        
        .config-input:focus {
            outline: var(--focus-ring);
            border-color: var(--primary-color);
        }
        
        .privacy-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-4);
            margin: var(--space-5) 0;
        }
        
        .metric-card {
            background: var(--background-secondary);
            padding: var(--space-4);
            border: 1px solid var(--border-color);
            text-align: center;
        }
        
        .metric-value {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--primary-color);
            margin-bottom: var(--space-1);
        }
        
        .metric-label {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading Dashboard...</div>
    </div>

    <!-- Main Dashboard Content -->
    <div class="dashboard-content" id="dashboardContent" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <h1>PKL Dashboard</h1>
                    <div class="header-nav">
                        <button id="refresh-btn" class="btn btn-nav">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                <path d="M21 3v5h-5"></path>
                                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                <path d="M3 21v-5h5"></path>
                            </svg>
                            Refresh
                        </button>
                        <div class="nav-divider"></div>
                        <button id="export-btn" class="btn btn-nav">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7,10 12,15 17,10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Export
                        </button>
                    </div>
                </div>
                
                <div class="header-center">
                    <div class="search-container">
                        <input type="text" id="global-search" placeholder="Search sessions, files, or prompts..." />
                        <button id="search-btn" class="btn btn-icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="M21 21l-4.35-4.35"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="header-right">
                    <div class="status-indicator">
                        <div class="status-dot disconnected" id="connectionStatus"></div>
                        <span class="status-text" id="connectionText">Connecting...</span>
                    </div>
                    <div class="header-actions">
                        <button id="privacy-analysis-btn" class="btn btn-secondary">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                            </svg>
                            Privacy
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Statistics Section -->
            <section class="stats-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalSessions">0</div>
                        <div class="stat-label">Total Sessions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeSessions">0</div>
                        <div class="stat-label">Active Sessions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completedSessions">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="failedSessions">0</div>
                        <div class="stat-label">Failed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalChanges">0</div>
                        <div class="stat-label">Code Changes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalConversations">0</div>
                        <div class="stat-label">Conversations</div>
                    </div>
                </div>
            </section>

            <!-- View Controls -->
            <div class="view-controls">
                <button class="view-btn active" id="timeline-view-btn" onclick="switchView('timeline')">Development Timeline</button>
                <button class="view-btn" id="projects-sessions-view-btn" onclick="switchView('projects-sessions')">Projects & Sessions</button>
                <button class="view-btn" id="notebooks-view-btn" onclick="switchView('notebooks')">Notebooks</button>
                <button class="view-btn" id="visualizations-view-btn" onclick="switchView('visualizations')">Workflow Analysis</button>
                <button class="view-btn" id="embeddings-view-btn" onclick="switchView('embeddings')">Clio & Kura</button>
            </div>

            <!-- Analysis Visualizations -->
            <section class="analysis-section" id="analysis-section">
                <h2 class="section-title">Session Analysis</h2>
                <div class="visualizations-grid">
                    <div class="viz-container">
                        <h3>Session Embeddings Map</h3>
                        <div id="embeddings-container" class="viz-content"></div>
                    </div>
                    <div class="viz-container">
                        <h3>Cell Stage Distribution</h3>
                        <div id="intent-timeline-container" class="viz-content"></div>
                    </div>
                </div>
            </section>

            <!-- Sessions List -->
            <section class="sessions-list" id="sessions-list">
                <!-- Sessions will be dynamically loaded here -->
            </section>
        </main>
    </div>

    <!-- Session Detail Modal -->
    <div class="modal" id="sessionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="session-detail-title">Session Details</h3>
                <button class="modal-close" onclick="closeSessionModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="session-detail-container">
                    <!-- Session details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Analysis Modal -->
    <div class="modal" id="privacyModal">
        <div class="modal-content privacy-modal-content">
            <div class="modal-header">
                <h3>Privacy Analysis</h3>
                <button class="modal-close" onclick="closePrivacyModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="privacy-analysis-container">
                    <h4>Privacy Configuration</h4>
                    <div class="privacy-controls-grid">
                        <div class="config-item">
                            <div class="config-label">Epsilon (Privacy Budget)</div>
                            <input type="range" class="config-input" id="epsilon-slider" min="0.1" max="10" step="0.1" value="1.0">
                            <span id="epsilon-value">1.0</span>
                        </div>
                        <div class="config-item">
                            <div class="config-label">Redaction Level (%)</div>
                            <input type="range" class="config-input" id="redaction-slider" min="0" max="100" step="5" value="50">
                            <span id="redaction-value">50%</span>
                        </div>
                        <div class="config-item">
                            <div class="config-label">Abstraction Level</div>
                            <input type="range" class="config-input" id="abstraction-slider" min="1" max="5" step="1" value="3">
                            <span id="abstraction-value">3</span>
                        </div>
                    </div>
                    
                    <div class="privacy-metrics">
                        <div class="metric-card">
                            <div class="metric-value" id="privacy-score">85</div>
                            <div class="metric-label">Privacy Score</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="expressiveness-score">0.75</div>
                            <div class="metric-label">Expressiveness</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="violation-count">3</div>
                            <div class="metric-label">Violations</div>
                        </div>
                    </div>
                    
                    <div class="privacy-actions">
                        <button class="btn btn-primary" onclick="runPrivacyAnalysis()">Run Analysis</button>
                        <button class="btn btn-secondary" onclick="exportPrivacyReport()">Export Report</button>
                        <button class="btn btn-outline" onclick="configurePrivacySettings()">Configure Settings</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div class="modal" id="infoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Dashboard Information</h3>
                <button class="modal-close" onclick="closeInfoModal()">&times;</button>
            </div>
            <div class="modal-body" id="info-modal-body">
                <div class="info-container">
                    <h4>About This Dashboard</h4>
                    <p>This is a real-time dashboard for monitoring coding sessions and development activities, specifically optimized for Jupyter notebook workflows in Cursor IDE.</p>
                    
                    <h4>Features</h4>
                    <ul>
                        <li>Real-time session monitoring</li>
                        <li>Enhanced cell-stage classification system</li>
                        <li>Timeline visualization with UMAP clustering</li>
                        <li>Privacy analysis and metrics</li>
                        <li>Project and session management</li>
                        <li>Data visualization and insights</li>
                        <li>Export and integration capabilities</li>
                        <li>Conversation data integration</li>
                        <li>Executable memory generation</li>
                    </ul>
                    
                    <h4>Data Sources</h4>
                    <p><strong>Conversation Data:</strong> Sourced from multiple channels:</p>
                    <ul>
                        <li><strong>Real-time monitoring:</strong> Cursor IDE's internal SQLite database via CursorDBParser</li>
                        <li><strong>API integration:</strong> Direct POST requests to /api/conversations endpoint</li>
                        <li><strong>IPC communication:</strong> Electron app integration via ConversationTracker service</li>
                        <li><strong>Data persistence:</strong> JSON-based storage with DataStorage service</li>
                    </ul>
                    
                    <h4>Keyboard Shortcuts</h4>
                    <div class="shortcuts-list">
                        <div class="shortcut-item">
                            <kbd>Ctrl/Cmd + F</kbd>
                            <span>Search sessions</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl/Cmd + R</kbd>
                            <span>Refresh data</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Escape</kbd>
                            <span>Close modals</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="components/cell-stage-classifier.js"></script>
    <script src="components/shared/dashboard.js"></script>
    <script src="components/real-data-visualizations.js"></script>
    
    <script>
        // Initialize dashboard when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing dashboard...');
            
            // Initialize the dashboard (handled by dashboard.js)
            // window.dashboard = new LiveDashboard();
            
            // Set up global event handlers
            setupGlobalEventHandlers();
            
            // Debug: Check if functions are available
            setTimeout(() => {
                console.log('Dashboard functions available:', {
                    switchView: typeof window.switchView,
                    viewSession: typeof window.viewSession,
                    openPrivacyModal: typeof window.openPrivacyModal,
                    dashboard: !!window.dashboard
                });
                
                // Ensure loading overlay is hidden
                const loadingOverlay = document.getElementById('loadingOverlay');
                if (loadingOverlay) {
                    console.log('Loading overlay still present, hiding it');
                    loadingOverlay.style.display = 'none';
                }
                
                // Ensure dashboard content is visible
                const dashboardContent = document.getElementById('dashboardContent');
                if (dashboardContent) {
                    dashboardContent.style.display = 'block';
                    console.log('Dashboard content made visible');
                }
                
                // Test button click functionality
                const testBtn = document.getElementById('privacy-analysis-btn');
                if (testBtn) {
                    console.log('Privacy button found, adding test click handler');
                    testBtn.addEventListener('click', function(e) {
                        console.log('Privacy button clicked!', e);
                    });
                }
            }, 1000);
        });

        // Global event handlers
        function setupGlobalEventHandlers() {
            // Refresh button
            document.getElementById('refresh-btn').addEventListener('click', function() {
                if (window.dashboard) {
                    window.dashboard.loadSessions();
                }
            });

            // Export button
            document.getElementById('export-btn').addEventListener('click', function() {
                if (window.dashboard) {
                    window.dashboard.exportData();
                }
            });

            // Privacy analysis button
            document.getElementById('privacy-analysis-btn').addEventListener('click', function() {
                openPrivacyModal();
            });


            // Global search - moved to after dashboard initialization
            setTimeout(() => {
                const searchInput = document.getElementById('global-search');
                const searchBtn = document.getElementById('search-btn');
                
                console.log('Search elements found:', {
                    searchInput: !!searchInput,
                    searchBtn: !!searchBtn
                });
                
                if (searchBtn) {
                    searchBtn.addEventListener('click', function() {
                        console.log('Search button clicked');
                        const query = searchInput.value.trim();
                        console.log('Search query:', query);
                        console.log('Dashboard available:', !!window.dashboard);
                        if (query && window.dashboard) {
                            window.dashboard.searchSessions(query);
                        } else if (!query) {
                            console.log('No query provided');
                        } else if (!window.dashboard) {
                            console.log('Dashboard not available');
                        }
                    });
                } else {
                    console.error('Search button not found');
                }

                if (searchInput) {
                    searchInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            console.log('Enter key pressed in search input');
                            if (searchBtn) {
                                searchBtn.click();
                            }
                        }
                    });
                } else {
                    console.error('Search input not found');
                }
            }, 1000);
        }

        // Modal functions
        function closeSessionModal() {
            const modal = document.getElementById('sessionModal');
            modal.classList.remove('active');
        }

        // Privacy modal functions are handled by dashboard.js

        // Global functions for HTML onclick handlers
        window.switchView = function(viewType) {
            if (window.dashboard) {
                window.dashboard.switchView(viewType);
            }
        };

        window.viewSession = function(sessionId) {
            if (window.dashboard) {
                window.dashboard.viewSession(sessionId);
            }
        };

        window.returnToContext = function(sessionId) {
            if (window.dashboard) {
                window.dashboard.returnToContext(sessionId);
            }
        };

        window.toggleCodeDeltas = function(sessionId) {
            if (window.dashboard) {
                window.dashboard.toggleCodeDeltas(sessionId);
            }
        };
    </script>
</body>
</html>
