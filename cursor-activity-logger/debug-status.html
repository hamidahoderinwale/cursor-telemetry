<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Status - Cursor Activity Logger</title>
    <style>
        body { font-family: monospace; margin: 20px; background: #f5f5f5; }
        .status { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { border-left: 4px solid #4CAF50; }
        .error { border-left: 4px solid #f44336; }
        .info { border-left: 4px solid #2196F3; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; background: #2196F3; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #1976D2; }
    </style>
</head>
<body>
    <h1>üîç Debug Status - Cursor Activity Logger</h1>
    
    <div class="status info">
        <h3>System Status</h3>
        <p>Companion Service: <span id="companion-status">Checking...</span></p>
        <p>SPA Service: <span id="spa-status">Checking...</span></p>
        <p>Queue Status: <span id="queue-status">Checking...</span></p>
    </div>
    
    <div class="status">
        <h3>Actions</h3>
        <button onclick="testCompanion()">Test Companion Service</button>
        <button onclick="testQueue()">Test Queue</button>
        <button onclick="testMCP()">Add Test Entry via MCP</button>
        <button onclick="openSPA()">Open SPA</button>
    </div>
    
    <div class="status">
        <h3>Debug Output</h3>
        <pre id="debug-output">Click a button to see debug information...</pre>
    </div>

    <script>
        const COMPANION_URL = 'http://127.0.0.1:43917';
        const SPA_URL = 'http://localhost:8000';
        
        function log(message) {
            const output = document.getElementById('debug-output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        async function testCompanion() {
            log('Testing companion service...');
            try {
                const response = await fetch(`${COMPANION_URL}/health`);
                const data = await response.json();
                document.getElementById('companion-status').textContent = `‚úÖ Running (${data.entries} entries, ${data.events} events)`;
                log(`Companion health: ${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                document.getElementById('companion-status').textContent = '‚ùå Error';
                log(`Companion error: ${error.message}`);
            }
        }
        
        async function testQueue() {
            log('Testing queue...');
            try {
                const response = await fetch(`${COMPANION_URL}/queue`);
                const data = await response.json();
                document.getElementById('queue-status').textContent = `üì• ${data.entries.length} entries, ${data.events.length} events`;
                log(`Queue data: ${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                document.getElementById('queue-status').textContent = '‚ùå Error';
                log(`Queue error: ${error.message}`);
            }
        }
        
        async function testMCP() {
            log('Adding test entry via MCP...');
            try {
                const response = await fetch(`${COMPANION_URL}/mcp/log-prompt-response`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        session_id: 'debug-session-' + Date.now(),
                        file_path: 'debug-test.js',
                        prompt: 'Debug test prompt from debug page',
                        response: 'Debug test response from debug page'
                    })
                });
                const data = await response.json();
                log(`MCP response: ${JSON.stringify(data, null, 2)}`);
                
                // Wait a moment and check queue
                setTimeout(async () => {
                    log('Checking queue after MCP...');
                    await testQueue();
                }, 1000);
            } catch (error) {
                log(`MCP error: ${error.message}`);
            }
        }
        
        function openSPA() {
            log('Opening SPA in new tab...');
            window.open(SPA_URL, '_blank');
        }
        
        // Test SPA status
        async function testSPA() {
            try {
                const response = await fetch(SPA_URL);
                if (response.ok) {
                    document.getElementById('spa-status').textContent = '‚úÖ Running';
                } else {
                    document.getElementById('spa-status').textContent = `‚ùå Error ${response.status}`;
                }
            } catch (error) {
                document.getElementById('spa-status').textContent = '‚ùå Error';
            }
        }
        
        // Initialize
        testCompanion();
        testSPA();
        testQueue();
        
        // Auto-refresh every 5 seconds
        setInterval(() => {
            testCompanion();
            testQueue();
        }, 5000);
    </script>
</body>
</html>
