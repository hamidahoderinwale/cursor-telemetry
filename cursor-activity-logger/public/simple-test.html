<!DOCTYPE html>
<html>
<head>
    <title>Simple Test</title>
    <script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>
</head>
<body>
    <h1>Simple Test</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        function log(msg) {
            output.innerHTML += `<div>${new Date().toISOString()}: ${msg}</div>`;
            console.log(msg);
        }
        
        async function test() {
            log('Starting test...');
            
            // Test 1: Basic fetch
            try {
                const response = await fetch('http://127.0.0.1:43917/health');
                const data = await response.json();
                log(`‚úÖ Companion health: ${data.status} (${data.entries} entries)`);
            } catch (error) {
                log(`‚ùå Companion health failed: ${error.message}`);
            }
            
            // Test 2: Queue fetch
            try {
                const response = await fetch('http://127.0.0.1:43917/queue?since=1970-01-01T00:00:00.000Z');
                const data = await response.json();
                log(`‚úÖ Queue fetch: ${data.entries.length} entries, ${data.events.length} events`);
                
                // Test 3: Database
                const db = new Dexie('TestDB');
                db.version(1).stores({
                    entries: '++id, session_id, timestamp, source, file_path'
                });
                
                await db.open();
                log('‚úÖ Database opened');
                
                // Add entries
                for (const entry of data.entries) {
                    try {
                        await db.entries.add(entry);
                        log(`‚úÖ Added entry: ${entry.file_path}`);
                    } catch (error) {
                        log(`‚ùå Error adding entry: ${error.message}`);
                    }
                }
                
                const count = await db.entries.count();
                log(`üìä Total entries in DB: ${count}`);
                
            } catch (error) {
                log(`‚ùå Queue fetch failed: ${error.message}`);
            }
        }
        
        test();
    </script>
</body>
</html>
